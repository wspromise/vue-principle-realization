{"version":3,"file":"vue.js","sources":["../utils/index.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["export function getDataType(target) {\r\n  return Object.prototype.toString.call(target).slice(8, -1);\r\n}\r\n","import { getDataType } from '../../utils';\r\n\r\nclass Observe {\r\n  constructor(data) {\r\n    this.walk(data);\r\n  }\r\n\r\n  walk(data) {\r\n    Object.keys(data).forEach((key) => {\r\n      ObjectReactive(data, key, data[key]);\r\n    });\r\n  }\r\n}\r\n\r\n// Vue2性能差就差在这个方法中，需要一加载时就递归调用defineProperty,耗性能\r\n// 性能优化原则\r\n// 1. 不要把所有数据都放在data中，否则都会添加get和set\r\n// 2. 数据层级不要过深，尽量扁平化数据\r\n// 3. 不要频繁的获取数据（每次获取数据都会调其get方法， get方法后期会有很多逻辑，耗性能）\r\n// 4. 如果数据不需要响应式，可以调用Object.freeze()冻结对象属性\r\n\r\nfunction ObjectReactive(data, key, value) {\r\n  // value也可能是可监测数据， 对value进行递归监测\r\n  observe(value);\r\n\r\n  // 使data中每个属性变成响应式的\r\n  Object.defineProperty(data, key, {\r\n    get() {\r\n      return value;\r\n    },\r\n\r\n    set(newValue) {\r\n      if (newValue === value) return;\r\n      value = newValue;\r\n    },\r\n  });\r\n}\r\n\r\nexport function observe(data) {\r\n  // 如果data不是一个对象或者数组(data中某个属性值可能是数组)则不再进行监测\r\n  if (getDataType(data) !== 'Object' || getDataType(data) === 'Array') return;\r\n\r\n  // 监测数据， 用类实现\r\n  new Observe(data);\r\n}\r\n","import { getDataType } from '../utils';\r\nimport { observe } from './observe';\r\n\r\nexport function initState(vm) {\r\n  const options = vm.$options;\r\n\r\n  options.data && initData(vm); // 如果有data则进行初始化\r\n}\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data; // 获取data选项\r\n\r\n  // 判断data是否是函数， 如果是则调用得到对象，如果是对象则直接使用即可\r\n  data = getDataType(data) === 'Function' ? data() : data;\r\n\r\n  // 观测数据，使用Object.defineProperty()来使data中数据变成响应式的\r\n  observe(data);\r\n}\r\n","import { initState } from './state';\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    this.$options = options; // 为 了后续扩展的方法，都可以获取到options了\r\n\r\n    // 初始化状态数据\r\n    initState(this);\r\n\r\n    if (this.$options.el) {\r\n      console.log('页面要挂载');\r\n    }\r\n  };\r\n}\r\n","import { initMixin } from './init';\r\n\r\n// Vue2的响应式原理是靠Object.defineProperty(), 双向绑定原理是靠v-model\r\nfunction Vue(options) {\r\n  this._init(options); // 实现Vue初始化功能\r\n}\r\n\r\ninitMixin(Vue);\r\n\r\n// 导出Vue供别人使用\r\nexport default Vue;\r\n"],"names":["getDataType","target","Object","prototype","toString","call","slice","Observe","constructor","data","walk","keys","forEach","key","ObjectReactive","value","observe","defineProperty","get","set","newValue","initState","vm","options","$options","initData","initMixin","Vue","_init","el","console","log"],"mappings":";;;;;;EAAO,SAASA,WAAT,CAAqBC,MAArB,EAA6B;EAClC,SAAOC,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,MAA/B,EAAuCK,KAAvC,CAA6C,CAA7C,EAAgD,CAAC,CAAjD,CAAP;EACD;;ECAD,MAAMC,OAAN,CAAc;EACZC,EAAAA,WAAW,CAACC,IAAD,EAAO;EAChB,SAAKC,IAAL,CAAUD,IAAV;EACD;;EAEDC,EAAAA,IAAI,CAACD,IAAD,EAAO;EACTP,IAAAA,MAAM,CAACS,IAAP,CAAYF,IAAZ,EAAkBG,OAAlB,CAA2BC,GAAD,IAAS;EACjCC,MAAAA,cAAc,CAACL,IAAD,EAAOI,GAAP,EAAYJ,IAAI,CAACI,GAAD,CAAhB,CAAd;EACD,KAFD;EAGD;;EATW;EAad;EACA;EACA;EACA;EACA;;;EAEA,SAASC,cAAT,CAAwBL,IAAxB,EAA8BI,GAA9B,EAAmCE,KAAnC,EAA0C;EACxC;EACAC,EAAAA,OAAO,CAACD,KAAD,CAAP,CAFwC;;EAKxCb,EAAAA,MAAM,CAACe,cAAP,CAAsBR,IAAtB,EAA4BI,GAA5B,EAAiC;EAC/BK,IAAAA,GAAG,GAAG;EACJ,aAAOH,KAAP;EACD,KAH8B;;EAK/BI,IAAAA,GAAG,CAACC,QAAD,EAAW;EACZ,UAAIA,QAAQ,KAAKL,KAAjB,EAAwB;EACxBA,MAAAA,KAAK,GAAGK,QAAR;EACD;;EAR8B,GAAjC;EAUD;;EAEM,SAASJ,OAAT,CAAiBP,IAAjB,EAAuB;EAC5B;EACA,MAAIT,WAAW,CAACS,IAAD,CAAX,KAAsB,QAAtB,IAAkCT,WAAW,CAACS,IAAD,CAAX,KAAsB,OAA5D,EAAqE,OAFzC;;EAK5B,MAAIF,OAAJ,CAAYE,IAAZ;EACD;;ECzCM,SAASY,SAAT,CAAmBC,EAAnB,EAAuB;EAC5B,QAAMC,OAAO,GAAGD,EAAE,CAACE,QAAnB;EAEAD,EAAAA,OAAO,CAACd,IAAR,IAAgBgB,QAAQ,CAACH,EAAD,CAAxB,CAH4B;EAI7B;;EAED,SAASG,QAAT,CAAkBH,EAAlB,EAAsB;EACpB,MAAIb,IAAI,GAAGa,EAAE,CAACE,QAAH,CAAYf,IAAvB,CADoB;EAGpB;;EACAA,EAAAA,IAAI,GAAGT,WAAW,CAACS,IAAD,CAAX,KAAsB,UAAtB,GAAmCA,IAAI,EAAvC,GAA4CA,IAAnD,CAJoB;;EAOpBO,EAAAA,OAAO,CAACP,IAAD,CAAP;EACD;;ECfM,SAASiB,SAAT,CAAmBC,GAAnB,EAAwB;EAC7BA,EAAAA,GAAG,CAACxB,SAAJ,CAAcyB,KAAd,GAAsB,UAAUL,OAAV,EAAmB;EACvC,SAAKC,QAAL,GAAgBD,OAAhB,CADuC;EAGvC;;EACAF,IAAAA,SAAS,CAAC,IAAD,CAAT;;EAEA,QAAI,KAAKG,QAAL,CAAcK,EAAlB,EAAsB;EACpBC,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;EACD;EACF,GATD;EAUD;;ECVD,SAASJ,GAAT,CAAaJ,OAAb,EAAsB;EACpB,OAAKK,KAAL,CAAWL,OAAX,EADoB;;EAErB;;EAEDG,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}